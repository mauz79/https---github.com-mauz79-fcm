<?php  function getmicrotime( ){  list( $usec, $sec) = explode( " ", microtime( ));  return ( ( float)$usec + ( float)$sec);  }  $start_time = getmicrotime( );    $content = file_get_contents ('http://www.fantacalcio.kataweb.it/stat/index.php?page=partita&ck_fantacalcio=BADSESSION&stat=1&cmp=A');   $content = str_replace(array("\n","\r"),"",$content);     $link = "#<td colspan=\"4\" class=\"no-border\">PARTITE</td>#si";  $link_results = preg_split($link, $content);  array_shift($link_results);  $link2 = "#<div class=\"testatina\"><h6>PROBABILI FORMAZIONI </h6></div>#si";  $link2_results = preg_split($link2, $link_results[0]);   $link3 = "#Formazioni</a>#si";  $link3_results = preg_split($link3, $link2_results[0]);   $link4 = "#<a href=\"#si";  for ($j=0;$j<=9;$j++) {  $link4_results[$j] = preg_split($link4, $link3_results[$j]);  ${"link_".$j} = str_replace(">","",$link4_results[$j]);  }       $Squadre_Corte = array("ATA","CAG","CAT","CHI","FIO","MIL","ROM","SAM","TOR","UDI","SIE","LAZ","GEN","REG","JUV","BOL","NAP","INT","LEC","PAL");  $Squadre_Lunghe = array("Atalanta","Cagliari","Catania","Chievo","Fiorentina","Milan","Roma","Sampdoria","Torino","Udinese","Siena","Lazio","Genoa","Reggina","Juventus","Bologna","Napoli","Inter","Lecce","Palermo");    $ind = 1;  $FileProxt = 'fcmPuffinProbFormFc.js';     $scrivi_file=fopen($FileProxt,"w");     fwrite($scrivi_file, "function Pf(Nome,Squadra,Status) {\r\n");       fwrite($scrivi_file, "this.Nome = Nome\r\nthis.Squadra = Squadra\r\nthis.Status = Status\r\n}\r\nvar arrProbFormFc=new Array()\r\na=arrProbFormFc\r\n");    for ($k=0;$k<=9;$k++) {  $content2 = file_get_contents ('http://www.fantacalcio.kataweb.it/stat/'.${"link_".$k}[3]);   $content2 = str_replace(array("\n","\r"),"",$content2);    $squadrain = explode("sqdcasa=",${"link_".$k}[3]);  $squadracasa = substr($squadrain[1],0,3);  $squadraout = explode("sqdfuori=",${"link_".$k}[3]);  $squadrafuori = substr($squadraout[1],0,3);    for ($s=0;$s<=19;$s++) {  if ($squadracasa == $Squadre_Corte[$s]) $squadracasa = $Squadre_Lunghe[$s];  if ($squadrafuori == $Squadre_Corte[$s]) $squadrafuori = $Squadre_Lunghe[$s];  }    $Squadre = array ($squadracasa,$squadrafuori);        $path = explode("<div class=\"uno\">",$content2 );  array_shift($path);   $sq1 = explode("<a href=\"index.php?page=gioscheda&ck_fantacalcio=BADSESSION&id",$path[0]);  array_shift($sq1);   for ($j=0;$j<=10;$j++) {  $nomiGioc[$j] = explode(">",$sq1[$j]);   $nome = explode(" ",str_replace(".","",strip_tags($nomiGioc[$j][1])));  $lung_nome = sizeof($nome);  $Qs = $lung_nome-1;  if ($lung_nome == 1) {  $nomefinale = $nome[0];  fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$nomefinale."\",\"".$squadracasa."\",\"t\")\r\n");   } else if ($lung_nome != 1) {   for ($i=0;$i<=$Qs;$i++) {    if (strlen($nome[$i]) == 1) unset($nome[$i]);   }   $nomefinale = implode("", $nome);        fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$nomefinale."\",\"".$squadracasa."\",\"t\")\r\n");  }  }        $sq2 = explode("<a href=\"index.php?page=gioscheda&ck_fantacalcio=BADSESSION&id",$path[1]);  array_shift($sq2);  for ($j=0;$j<=10;$j++) {  $nomiGioc2[$j] = explode(">",$sq2[$j]);  $nome2 = explode(" ",str_replace(".","",strip_tags($nomiGioc2[$j][1])));  $lung_nome2 = sizeof($nome2);  $Qs2 = $lung_nome2-1;  if ($lung_nome2 == 1) {  $nomefinale2 = $nome2[0];   fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$nomefinale2."\",\"".$squadrafuori."\",\"t\")\r\n");  } else if ($lung_nome2 != 1) {   for ($i=0;$i<=$Qs2;$i++) {    if (strlen($nome2[$i]) == 1) unset($nome2[$i]);   }   $nomefinale2 = implode("", $nome2);      fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$nomefinale2."\",\"".$squadrafuori."\",\"t\")\r\n");  }  }                 $sq3 = explode("INFORTUNATI",$path[1]);  $sq3 = explode("SQUALIFICATI",$sq3[1]);  $sq4 = explode("<table cellspacing=\"0\">",$sq3[0]);  array_shift($sq4);   $sq5 = (trim(strip_tags($sq4[0])));  $SquadreInf =explode("\t",$sq5);       for ($kI=1;$kI<=2;$kI++){  $sq6 = (trim(strip_tags($sq4[$kI])));  $sq6 = str_replace("\t"," ",$sq6);  $sq6 = str_replace("\r\n", "", $sq6);   $sq6 = str_replace(" ", "-", $sq6);   $sq6 = ereg_replace("-{2,}", "-", $sq6);  $sq6 = explode("-",$sq6);  $lunghezza_sq6 = sizeof($sq6)-1;  for ($i=0;$i<=$lunghezza_sq6;$i++) {  if(strlen($sq6[$i]) == "1") {  unset ($sq6[$i]);  } else if (preg_match('/^[a-zA-Z]+[a-z]/',$sq6[$i])) {  $sq6[$i] = ",";   }  }  $sq7 = implode($sq6);  $sq7 = explode(",",$sq7);  $lung_sq7 = sizeof($sq7)-1;  for ($e=0;$e<=$lung_sq7;$e++) {   if ($sq7[$e] != "") fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$sq7[$e]."\",\"".$SquadreInf[$kI-1]."\",\"i\")\r\n");  }  }               $sq30 = explode("POTREBBERO GIOCARE",$path[1]);  $sq30 = explode("INFORTUNATI",$sq30[1]);  $sq40 = explode("<table cellspacing=\"0\">",$sq30[0]);  array_shift($sq40);   $sq50 = (trim(strip_tags($sq40[0])));  $SquadreInf =explode("\t",$sq50);    for ($kP=1;$kP<=2;$kP++){   ${$panchina.$kP} = array();  $sq6nome = array();  $sq6prec = array();  $sq60 = (trim(strip_tags($sq40[$kP])));  $sq60 = str_replace("\t"," ",$sq60);  $sq60 = str_replace("\r\n", "", $sq60);   $sq60 = str_replace(" ", "-", $sq60);   $sq60 = ereg_replace("-{2,}", "-", $sq60);  $sq60 = explode("-",$sq60);  $lunghezza_sq60 = sizeof($sq60)-1;  $Index_new = 0;  for ($i=0;$i<=$lunghezza_sq60;$i++) {  if(strlen($sq60[$i]) == "1" || preg_match('/^[a-zA-Z]+[a-z]/',$sq60[$i])) {  unset ($sq60[$i]);  }  }   for ($ii=0;$ii<=$lunghezza_sq60;$ii++) {  if (preg_match('/[A-Z]/',$sq60[$ii+1]) && (preg_match('/[A-Z]/',$sq60[$ii+1]) || $sq60[$ii+1] == undefined)) {  $sq6nome[$Index_new] = $sq60[$ii].$sq60[$ii+1];  } else if (preg_match('/[0-9]/',$sq60[$ii])) {  $sq6prec[$Index_new] = str_replace("%)","",str_replace("(","",$sq60[$ii]));  $Index_new++;  }  }   $lung_panchinari =sizeof($sq6nome)-1;  for ($iu=0;$iu<=$lung_panchinari;$iu++) {    ${$panchina.$kP}[$sq6nome[$iu]] = $sq6prec[$iu];  }    arsort(${$panchina.$kP});       for ($eu=0;$eu<=6;$eu++) {  $giocatore = each (${$panchina.$kP});   fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$giocatore[key]."\",\"".str_replace(" ","",$SquadreInf[$kP-1])."\",\"p\")\r\n");  }    }            }    $content = file_get_contents ('http://www.fantacalcio.kataweb.it/stat/index.php?page=squalificati&ck_fantacalcio=BADSESSION&stat=1&cmp=A');   $content = str_replace(array("\n","\r"),"",$content);    $primoSqual = explode("<!-- BEGIN CORPO DELLA PAGINA -->",$content);  array_shift($primoSqual);  $secondoSqual = explode("<!-- END CORPO DELLA PAGINA -->",$primoSqual[0]);  $terzoSqual = explode("Calciatore",$secondoSqual[0]);  array_shift($terzoSqual);  $QuartoSqual = explode("</a>",$terzoSqual[0]);  $lung_array_Squal = sizeof($QuartoSqual)-1;  unset ($QuartoSqual[$lung_array_Squal]);  for ($i=0;$i<=$lung_array_Squal-1;$i+=2) {  $GiocatoreSqual = substr(strip_tags($QuartoSqual[$i+1]),1);   $GiocatoreSqual = preg_replace('#\s*\b[A-Z][a-z]+\b#', '',$GiocatoreSqual);  $GiocatoreSqual = explode(" ",$GiocatoreSqual);  $GiocatoreSqual_lung = sizeof($GiocatoreSqual)-1;  for ($j=0;$j<=$GiocatoreSqual_lung;$j++){  $GiocatoreSqual[$j] = str_replace(" ","",$GiocatoreSqual[$j]);  if (strlen($GiocatoreSqual[$j]) == 1) unset($GiocatoreSqual[$j]);  }  $GiocatoreSqualDef = implode("",$GiocatoreSqual);   fwrite($scrivi_file, "a[".$ind++."]=new Pf(\"".$GiocatoreSqualDef."\",\"".strip_tags($QuartoSqual[$i])."\",\"s\")\r\n");  }                          fclose($scrivi_file);    $end_time = getmicrotime( );       $gd = ImageCreate(32, 32);  $red = ImageColorAllocate($gd, 255, 0, 0);  ImageFilledRectangle($gd, 0, 0, 31, 31, $red);  Header('Content-Type: image/gif');  ImageGif($gd);  die();  ?>
